# Java 소켓 통신 한글 처리 가이드

## 문제 상황
Java 소켓 통신에서 한글 메시지를 주고받을 때 `?????`와 같이 물음표로 출력되는 문제 발생

## 원인
- Java의 기본 인코딩과 시스템 인코딩이 다른 경우
- InputStreamReader와 OutputStreamWriter 생성 시 명시적인 인코딩 지정 없이 사용
- Windows 시스템의 기본 인코딩(MS949)과 리눅스/맥 시스템의 기본 인코딩(UTF-8) 차이

## 해결 방법

### 1. 서버 측 (ChatServer.java)

#### 수정 전
```java
BufferedReader in = new BufferedReader(
    new InputStreamReader(socket.getInputStream()));
PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
```

#### 수정 후
```java
BufferedReader in = new BufferedReader(
    new InputStreamReader(socket.getInputStream(), "UTF-8"));
PrintWriter out = new PrintWriter(
    new OutputStreamWriter(socket.getOutputStream(), "UTF-8"), true);
```

### 2. 클라이언트 측 (ChatClient.java)

#### 수정 전
```java
BufferedReader in = new BufferedReader(
    new InputStreamReader(socket.getInputStream()));
PrintWriter out = new PrintWriter(socket.getOutputStream(), true);
Scanner scanner = new Scanner(System.in);
```

#### 수정 후
```java
BufferedReader in = new BufferedReader(
    new InputStreamReader(socket.getInputStream(), "UTF-8"));
PrintWriter out = new PrintWriter(
    new OutputStreamWriter(socket.getOutputStream(), "UTF-8"), true);
Scanner scanner = new Scanner(System.in, "UTF-8");
```

## 핵심 포인트

### 1. UTF-8 인코딩 명시
- 모든 입출력 스트림에 UTF-8 인코딩을 명시적으로 지정
- `InputStreamReader`, `OutputStreamWriter`, `Scanner` 생성 시 "UTF-8" 파라미터 추가

### 2. 양방향 일치
- 서버와 클라이언트 모두 동일한 인코딩(UTF-8) 사용
- 한쪽만 수정하면 여전히 깨짐 현상 발생

### 3. 컴파일 및 실행 시 인코딩
```bash
# 컴파일 시 UTF-8 지정
javac -encoding UTF-8 ChatServer.java
javac -encoding UTF-8 ChatClient.java

# 실행 시 UTF-8 지정 (필요한 경우)
java -Dfile.encoding=UTF-8 com.example.net.ChatServer
java -Dfile.encoding=UTF-8 com.example.net.ChatClient
```

## 추가 고려사항

### 1. StandardCharsets 사용 (Java 7+)
```java
import java.nio.charset.StandardCharsets;

// 문자열 대신 상수 사용
new InputStreamReader(socket.getInputStream(), StandardCharsets.UTF_8);
```

### 2. 시스템 기본 인코딩 확인
```java
System.out.println("Default Charset: " + Charset.defaultCharset());
System.out.println("file.encoding: " + System.getProperty("file.encoding"));
```

### 3. 크로스 플랫폼 호환성
- UTF-8은 모든 플랫폼에서 지원되는 표준 인코딩
- 다국어 지원이 필요한 경우 반드시 UTF-8 사용 권장

## 테스트 방법

1. 서버 실행
```bash
java com.example.net.ChatServer 8020
```

2. 클라이언트 실행
```bash
java com.example.net.ChatClient
```

3. 한글 메시지 테스트
```
닉네임: 홍길동
메시지: 안녕하세요. 한글 테스트입니다.
```

4. 정상 출력 확인
- 물음표(?)가 아닌 정상적인 한글 표시 확인

## 문제 해결 체크리스트

- [ ] 서버의 InputStreamReader에 UTF-8 인코딩 지정
- [ ] 서버의 OutputStreamWriter에 UTF-8 인코딩 지정
- [ ] 클라이언트의 InputStreamReader에 UTF-8 인코딩 지정
- [ ] 클라이언트의 OutputStreamWriter에 UTF-8 인코딩 지정
- [ ] Scanner에 UTF-8 인코딩 지정
- [ ] 소스 파일이 UTF-8로 저장되어 있는지 확인
- [ ] 컴파일 시 -encoding UTF-8 옵션 사용